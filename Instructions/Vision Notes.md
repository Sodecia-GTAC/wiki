# Vision Notes

## Kuka/VisionTech
!!!Drag Result Output of PMAlign to Result Collector to add new Inputs!!!

### Vision Task Setup Steps
1. Connect the PoE switch to KUKA controller, PoE vision sensor, and 24V source...then establish communication with the vision sensor, and license the controller.
   The Runtime/Controller license is the Activation ID with MAX3D in the Product Name (doesn't include KUKA)
   The Engineering/Work Visual license is the Activation ID with MAX3DKUKA in the Product Name

2. Adjust the sensors aperture (light exposure) AND field of view (focus/clarity.)  Grey contrast is better than white contrast

3. Calibrate the vision sensor using the Calibration Wizard in VisionTech by taking a picture of the plate, and then measure a base frame on the calibration plate to reference it's position in relation to the robot.
   Calibration plate should be positioned using a square mount that has a consistent positionCalibration plate origin is not at the center of the plate (reference image below)Use a pointed TCP tool for measuring the calibration plate base frame

4. After measuring the calibration plate frame, calibrate the vision sensor using the plate and utility in VisionTech, select the base frame that was measured by the robot in the previous step OR measure it now.

5. Take an image with the calibrated sensor, and use this to develop the tool block in Work Visual.  (Need VisionTech development license in WorkVisual)

6. Develop the vision task with the tool block made in Work Visual, then execute the vision task multiple times to verify its consistency with similar values across multiple tests.  Also use real world measurement against vision measurement to verify accuracy. 

7. Run the Vision Task KRL program and update the corrected base frame to get these real world measurements

8. Once the accuracy and consistency are verified with the vision task, create a KRL(Kinetic Rule Language) VisionTech program.

9. Teach the robot path to the measured part using the corrected base frame after executing the vision task.

10. Test picking up other components in different orientation to verify the calibration is working correctly.  This also verifies the TCP accuracy in relation to moving to the part consistently. 

### Re-calibration
1. Get usable TCP for base calibration. 
2. Measure base frame on calibration plate. 
3. Capture calibration plate with vision sensor.
4. Call robot vision pickup task, and reteach robot pickup path AFTER taking a new image with the calibrated task.

---

### Absolute Positioning 
- Used when recognizing more than 1 part type in a single vision task OR single part model does not need frequent remodelling
- The vision task will compare the tool-blocked component's origin to the origin of the calibration plate
- If the component origin is located in the same position as the calibration origin the measured position should measure near [X 0, Y 0]


### Relative Positioning (Modelled Component)
- Used when recognizing 1 part type in a single vision task that may need to be re-modelled frequently
- The vision task will compare the tool-blocked component's origin to the modelled component's origin



!!!Calibration origin not located at the centre of the Fiducial Mark!!!


Example Camera Capture

---

Various Job Setup Pictures

Toolblock Layout



### Notes:
- To add a new result input to a result collector, drag and drop a result output from another Tool (PmAlign) and the input will be generated automatically in the Result Collector

#### Pattern Training Settings


#### Run/Detection Parameters


#### Graphic Display Settings (Shown on image after task run)



---

### License Handling (Work Visual & KRC Controller)
- VPRO-MAX3DKUKA is for WorkVisual, while VPRO-MAX3D is for the Controller

This link below will allow you to manually activate the license with the file generated by WorkVisual.

http://license.cognex.com/flexnet/operationsportal/showEntitlementLogon.do

The "Trusted Offline Activation" page is where the license can be activated.

The "List Licenses" page will show where the current license is active.


---

### GigE Switch Configuration

1. Make sure that your GigE camera is connected to the adapter and powered on before configuring any IP address.
2. Stop any applications that use CVL or VisionPro.
3. Start the GigE Vision Configuration Tool for VisionPro on the robot controller through the start menu by choosing:  Cognex->VisionPro->Utilities->GigE Vision Configuration Tool
4. Select a camera on the left.  The center panel displays information about the selected camera.
5. Enter an IP Address and Subnet mask for the camera.
6. Click Update Camera Address

---

### Troubleshooting

- If Vision Task specified cannot be found, remove the line "Task Name[] = '[task here]'" in the KRL-module and replace with the same line from a new KRL VisionTech template, and change the name to the correct task.
- If KRL-module is stuck @ "WAIT FOR $FLAG[1] or not $FLAG[997]" -- close the program and open VisionTech > Sensor Overview, then refresh the sensors -- The KRL-module should operate correctly (This is due to the communication to the vision sensor not being established and ended correctly within the KRL-module)
- If having issues overwriting tool blocks from WorkVisual -- delete toolblock from KUKA HMI (C:\KRC\TP\VisionTech\Toolblocks), then download new toolblock from WorkVisual

---

## Cognex

### Calculation Example for FOV & Depth of Field

3" Piece

Example 1
```
4" (101mm) FOV @ 640x480pix (0.3MP)
Step 1: pix/mm 640pix/101mm = 6.4pix/mm
Step 2: mm/pix 1/6.4 = 0.156mm/pix
            Resolution = +/-0.156mm
Step 3: Safety Factor Resolution - 10x = 0.156 = +/-1.56mm
            Backlight Safety Factor - 5x
```
Example 2
```
4" (101mm) FOV @ 1280x1024 (1.3MP)
 Step 1: pix/mm 1280pix/101mm = 12.8pix/mm  
Step 2: mm/pix = 1/12.8 = 0.075 mm/pix
            Resolution = +/-0.075mm
```

---

### Notes:
- High Gain causes bad image quality -- adds grain and pixelation (should be last option adjusted) 
- Long Exposure causes longer processing times (processes image for X time)
- Top Help Menu within In-Sight Explorer is not for Easy Builder, Easy Builder help is in Palette
- Locate Part Tools are used to reference the part and determine features
- Inspect Part Tools uses referenced information from Locate Part Tools
- Strict Scoring evaluates the edge AND the surface material. Without strict scoring it will only evaluate the edge of the components

---

## Keyence
   nothing lol

		









